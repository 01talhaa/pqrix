# Invoice & Milestone Management - Quick Reference

## UI Layout in Booking Edit Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit Booking                                      [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Status: [Dropdown] â–¼                                   â”‚
â”‚  Progress: [0-100] â–â–â–â–â–â–â–â–â–â–â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%           â”‚
â”‚                                                          â”‚
â”‚  Start Date: [Date Picker]                              â”‚
â”‚  Est. Completion: [Date Picker]                         â”‚
â”‚                                                          â”‚
â”‚  Admin Notes: [Text Area]                               â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° Payment Milestones              [Partial] âš ï¸       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Total: à§³40,000 | Paid: à§³20,000 | Due: à§³20,000 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 1: Initial Design           [Completed] âœ“  â”‚  â”‚
â”‚  â”‚ Create initial 3D designs and mockups            â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Amount: à§³10,000 (25%)                           â”‚  â”‚
â”‚  â”‚ Payment: [âœ“ Paid] â†â”€ Click to Toggle            â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Status: [Completed â–¼]                            â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ âœ“ Paid on Jan 15, 2024                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 2: Development             [In Progress] âš™ï¸ â”‚  â”‚
â”‚  â”‚ Build 3D models and animations                   â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Amount: à§³10,000 (25%)                           â”‚  â”‚
â”‚  â”‚ Payment: [âœ“ Paid] â†â”€ Click to Toggle            â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Status: [In Progress â–¼]                          â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ âœ“ Paid on Jan 20, 2024                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 3: Review                    [Pending] â³   â”‚  â”‚
â”‚  â”‚ Client review and feedback                       â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Amount: à§³10,000 (25%)                           â”‚  â”‚
â”‚  â”‚ Payment: [âœ— Unpaid] â†â”€ Click to Toggle          â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Status: [Pending â–¼]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 4: Delivery                  [Pending] â³   â”‚  â”‚
â”‚  â”‚ Final delivery and handover                      â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Amount: à§³10,000 (25%)                           â”‚  â”‚
â”‚  â”‚ Payment: [âœ— Unpaid] â†â”€ Click to Toggle          â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Status: [Pending â–¼]                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Timeline                              [+ Add Phase]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ... (existing timeline phases) ...                     â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              [Cancel]  [Save Changes]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Payment Status Toggle Behavior

### Before Click (Unpaid)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ— Unpaid       â”‚  â† Gray outline
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Click (Paid)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ Paid         â”‚  â† Green background
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
Updates automatically:
â€¢ milestone.paidAmount = milestone.amount
â€¢ milestone.paidDate = now
â€¢ invoice.paidAmount += milestone.amount
â€¢ invoice.remainingAmount -= milestone.amount
â€¢ invoice.status recalculated
```

## Status Badge Colors

### Invoice Status (Top Right)
```
[Paid] âœ“      â†’ Green
[Partial] âš ï¸  â†’ Yellow
[Unpaid] âœ—    â†’ Red
```

### Milestone Status
```
[Completed] âœ“    â†’ Green
[In Progress] âš™ï¸ â†’ Blue
[Pending] â³     â†’ Gray
```

## Workflow Example

### Admin Receives Payment
```
1. Client sends payment notification
   â†“
2. Admin opens booking edit dialog
   â†“
3. Scrolls to Payment Milestones
   â†“
4. Finds the relevant milestone
   â†“
5. Clicks [âœ— Unpaid] button
   â†“
6. Button changes to [âœ“ Paid] (green)
   â†“
7. Invoice summary updates:
   â€¢ Paid: à§³10,000 â†’ à§³20,000
   â€¢ Remaining: à§³30,000 â†’ à§³20,000
   â€¢ Status: Unpaid â†’ Partial
   â†“
8. Admin clicks [Save Changes]
   â†“
9. Both booking and invoice update
   â†“
10. Client sees updated invoice
```

## API Flow

```
User clicks Save
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUT /api/bookings/{id}    â”‚
â”‚  (Update booking data)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUT /api/invoices/{id}    â”‚
â”‚  (Update milestones)       â”‚
â”‚                            â”‚
â”‚  Auto-calculates:          â”‚
â”‚  â€¢ paidAmount              â”‚
â”‚  â€¢ remainingAmount         â”‚
â”‚  â€¢ status                  â”‚
â”‚  â€¢ paidDate                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Success notification
    â†“
Dialog closes
    â†“
Booking list refreshes
```

## Key Features

### âœ… Single Page Management
- No need to switch between booking and invoice pages
- All controls in one unified interface

### âœ… Real-Time Calculations
- Amounts update instantly when toggling payments
- Status badges change automatically
- No manual calculations needed

### âœ… Visual Feedback
- Color-coded status indicators
- Checkmarks for paid milestones
- Progress indicators

### âœ… Automatic Data Sync
- Saves booking and invoice together
- Maintains data consistency
- Updates both databases in one operation

### âœ… Service Step Integration
- Milestones automatically created from service.process
- Step names and descriptions pulled from service data
- No manual milestone creation needed

## Quick Actions

| Action | Result |
|--------|--------|
| Click **Unpaid** button | â†’ Marks milestone as **Paid**, adds amount to total |
| Click **Paid** button | â†’ Marks milestone as **Unpaid**, subtracts amount |
| Change Status dropdown | â†’ Updates milestone work status (Pending/In Progress/Completed) |
| Click **Save Changes** | â†’ Updates both booking and invoice in database |
| Close dialog | â†’ Clears state, discards unsaved changes |

## Data Flow

```
Service Process Steps
        â†“
  Create Booking
        â†“
  Generate Invoice
        â†“
Create Milestones (from process)
        â†“
Edit Booking Dialog
        â†“
  Load Invoice Data
        â†“
Display Milestones UI
        â†“
Admin Toggles Payment
        â†“
Update State (client-side)
        â†“
Click Save
        â†“
Update Database (server-side)
        â†“
Refresh Booking List
```

## Color Palette

| Element | Color | Usage |
|---------|-------|-------|
| Paid Status | Green (#22c55e) | Completed payments |
| Partial Status | Yellow (#eab308) | Some payments made |
| Unpaid Status | Red (#ef4444) | No payments made |
| In Progress | Blue (#3b82f6) | Currently working |
| Pending | Gray (#6b7280) | Not started yet |
| Completed | Green (#22c55e) | Work finished |

## Technical Notes

- Invoice loads automatically when `editingBooking.invoiceId` exists
- Loading spinner shown while fetching invoice data
- State management: `editingInvoice` and `loadingInvoice`
- TypeScript types: `InvoiceDocument`, `InvoiceMilestone`
- API endpoint: `/api/invoices/[id]` (PUT and GET)
- All calculations done client-side, then saved to server
- No data loss on cancel (state reset)
